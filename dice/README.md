the architectural flow of the contract is as in the image below:

![alt text](image.png)